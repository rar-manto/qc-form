<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Form QC - CV. Kurnia Jaya</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        'orange-primary': '#FF8C00',
        'orange-secondary': '#FFA500',
        'orange-light': '#FFE4B5'
      }
    }
  }
}
</script>
</head>

<body class="bg-gray-50 min-h-screen py-8">

<script>
/* =======================
   KONFIGURASI GLOBAL
======================= */
const GAS_URL = "https://script.google.com/macros/s/AKfycbwg6nZn4Hxv9ccc8p4U_lpwd6e53CGHDlzcKHyfMCpCXhfKPtY9hnpO38MKaSMGW8BA/exec";

/* =======================
   LOGIN SYSTEM
======================= */
const validUsers = {
  admin: { password: 'qc2024', name: 'Admin' },
  operator1: { password: 'op123', name: 'Operator 1' },
  operator2: { password: 'op456', name: 'Operator 2' },
  operator3: { password: 'op789', name: 'Operator 3' },
  supervisor: { password: 'sv456', name: 'Supervisor' }
};

function checkLoginStatus() {
  const user = localStorage.getItem('loggedInUser');
  if (user) showMainApp(JSON.parse(user));
}

function showMainApp(user) {
  document.getElementById('loginScreen').style.display = 'none';
  document.getElementById('mainApp').style.display = 'block';
  document.getElementById('currentUser').textContent = user.name;
  initializeApp();
}

function logout() {
  localStorage.removeItem('loggedInUser');
  location.reload();
}

/* =======================
   INIT APP
======================= */
function initializeApp() {
  document.getElementById('tanggal').valueAsDate = new Date();
  updateTotals();
  updateDailySummary();
}

/* =======================
   TOTAL KEMASAN
======================= */
function updateTotals() {
  const jenis = document.querySelectorAll('select[name="jenisKemasan[]"]');
  const jumlah = document.querySelectorAll('input[name="jumlahSpesifik[]"]');

  let t = { IBC:0, DRUM:0, JERIGEN:0, ZAK:0 };

  jenis.forEach((j,i)=>{
    const k = j.value;
    const n = parseInt(jumlah[i].value) || 0;
    if (t[k] !== undefined) t[k] += n;
  });

  totalIbc.value = t.IBC;
  totalDrum.value = t.DRUM;
  totalJerigen.value = t.JERIGEN;
  totalZak.value = t.ZAK;
}

/* =======================
   REKAP HARIAN (SERVER)
======================= */
async function updateDailySummary() {
  try {
    const r = await fetch(GAS_URL);
    const s = await r.json();

    ibcCount.textContent = s.IBC || 0;
    drumCount.textContent = s.DRUM || 0;
    jerigenCount.textContent = s.JERIGEN || 0;
    zakCount.textContent = s.ZAK || 0;
  } catch (e) {
    console.error("Rekap gagal", e);
  }
}

/* =======================
   SUBMIT FORM
======================= */
document.addEventListener('DOMContentLoaded', ()=>{
checkLoginStatus();

document.getElementById('loginForm').addEventListener('submit', e=>{
  e.preventDefault();
  const u = username.value;
  const p = password.value;

  if (validUsers[u] && validUsers[u].password === p) {
    localStorage.setItem('loggedInUser', JSON.stringify({
      username:u, name:validUsers[u].name
    }));
    showMainApp({name:validUsers[u].name});
  } else {
    loginError.classList.remove('hidden');
  }
});

document.getElementById('qcForm').addEventListener('submit', async e=>{
  e.preventDefault();
  submitBtn.disabled = true;
  submitBtn.textContent = "Mengirim...";

  try {
    const fd = new FormData(e.target);
    const namaProduk = fd.getAll









